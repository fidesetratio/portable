<!doctype html>
<!--
* Tabler - Premium and Open Source dashboard template with responsive and high quality UI.
* @version 1.0.0-beta3
* @link https://tabler.io
* Copyright 2018-2021 The Tabler Authors
* Copyright 2018-2021 codecalm.net PaweÅ‚ Kuna
* Licensed under MIT (https://github.com/tabler/tabler/blob/master/LICENSE)
-->
<html lang="en">
 
   <head th:include="fragments/layoutdashboard :: main-header">       
  </head>
 
  <body class="antialiased">
  
    <div class="wrapper">
  
      <div class="sticky-top">
       <div th:insert="fragments/layoutdashboard :: header"></div>
       <div th:insert="fragments/layoutdashboard :: menu"></div>
      </div>
      
    
      <div class="page-wrapper">
       
       <div class="container-xl">
          <!-- Page title -->
          <div class="page-header d-print-none">
            <div class="row align-items-center">
              <div class="col">
                <h2 class="page-title">
                  Users
                </h2>
              </div>
            </div>
          </div>
        </div>
        <div class="page-body">
          <div class="container-xl">
            <!-- Content here -->
            
            	
        			
                    <div class="col-12">
        
        	        <div class="card">
                  <div class="card-header">
                    <h3 class="card-title">Users</h3>
                    
      
                    
                  </div>
      
      	   	
      		
      			
                  <div class="card-body border-bottom py-3">
         	
      	<div class="alert alert-important alert-success alert-dismissible" style="display:none" id="showalert" role="alert">
  <div class="d-flex">
    <div>
      <!-- Download SVG icon from http://tabler-icons.io/i/check -->
      <!-- SVG icon code with class="alert-icon" -->
    </div>
    <div id="successfulMessage">
      Your account has been saved!
    </div>
  </div>
  <a class="btn-close btn-close-white" data-bs-dismiss="alert" aria-label="close"></a>
</div>
      	
      	
      				<div class="row" style="margin-bottom:20px;">
      					<div class="col-xl-12">
      					                   <a th:href="@{um-add-user}" class="btn btn-primary ms-auto">Add Users</a>
      					</div>
      				    
      				</div>
      	    	 	 			
                    <div class="d-flex">
                      <div class="text-muted">
                        Show
                        <div class="mx-2 d-inline-block">
                          <input type="text" class="form-control form-control-sm" value="8" size="3" aria-label="Invoices count">
                        </div>
                        entries
                      </div>
                      <div class="ms-auto text-muted">
                        Search:
                        <div class="ms-2 d-inline-block">
                          <input type="text" class="form-control form-control-sm" aria-label="Search invoice">
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="table-responsive">
                    <table class="table-white card-table table-vcenter text-nowrap datatable">
                      <thead>
                        <tr>
                          <th class="w-1"><input class="form-check-input m-0 align-middle" id="selectallcheckbox" type="checkbox"></th>
                          <th class="w-1">Name. <!-- Download SVG icon from http://tabler-icons.io/i/chevron-up -->
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-sm text-dark icon-thick" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><polyline points="6 15 12 9 18 15" /></svg>
                          </th>
                          <th>Groups</th>
                          <th>Status</th>
                          <th></th>
                        </tr>
                      </thead>
                      <tbody>
                      <tr th:if="${tables.empty}"><td colspan="4"> No Users Available </td></tr>
                      	
                        <tr th:each="user:${tables}" th:attr="id='tr'+${user.userId}">
                          <td><input class="form-check-input m-0 align-left checkme" type="checkbox" aria-label="Select invoice"></td>
                          <td>  <div class="d-flex py-1 align-items-center">
                              <span class="avatar me-2" >
                              <img class="avatar me-2"th:src="@{imgu/{photo}(photo=${user.photo})}"/>
                            
                              </span>
                                <div class="flex-fill">
                                <div class="font-weight-medium"><span th:text="${user.username}"></span></div>
                                <div class="text-muted"><a href="#" class="text-reset" th:text="${user.email}">lmiona@livejournal.com</a></div>
                              </div>
                            </div>
                          </td>
                          <td>
                       			 <div th:each="val,ob : ${#strings.arraySplit(user.groupMembers, ',')}">
                       			 		<span th:text="${val}"/>
                       			 </div>   	
                          
                          </td>
                          <td>
                            <span class="badge  me-1" th:classappend="${user.active == 1 ? 'bg-success' : 'bg-warning'}"></span> <span  th:text="${user.active == 1} ? 'active' : 'Disabled'">Active</span>
                          </td>
                          <td class="text-end">
                            <span class="dropdown">
                              <button class="btn dropdown-toggle align-text-top" data-bs-boundary="viewport" data-bs-toggle="dropdown">Actions</button>
                              <div class="dropdown-menu dropdown-menu-end">
                                <a class="dropdown-item" href="#">
                                  Edit
                                </a>
                                <a class="removeId dropdown-item" href="#"  data-id="0" th:attr="data-id=${user.userId}" data-bs-toggle="modal" data-bs-target="#confirm-delete">
								 Remove
								 
                                </a>
                              </div>
                            </span>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div class="card-footer d-flex align-items-center">
                    <p class="m-0 text-muted">Showing <span>1</span> to <span>8</span> of <span>16</span> entries</p>
                    <ul class="pagination m-0 ms-auto">
                      <li class="page-item disabled">
                        <a class="page-link" href="#" tabindex="-1" aria-disabled="true">
                          <!-- Download SVG icon from http://tabler-icons.io/i/chevron-left -->
                          <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><polyline points="15 6 9 12 15 18" /></svg>
                          prev
                        </a>
                      </li>
                      <li class="page-item"><a class="page-link" href="#">1</a></li>
                      <li class="page-item active"><a class="page-link" href="#">2</a></li>
                      <li class="page-item"><a class="page-link" href="#">3</a></li>
                      <li class="page-item"><a class="page-link" href="#">4</a></li>
                      <li class="page-item"><a class="page-link" href="#">5</a></li>
                      <li class="page-item">
                        <a class="page-link" href="#">
                          next <!-- Download SVG icon from http://tabler-icons.io/i/chevron-right -->
                          <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><polyline points="9 6 15 12 9 18" /></svg>
                        </a>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
     

          </div>
        </div>
        
         
         
         
           <div class="modal modal-blur fade" id="confirm-delete" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog modal-sm modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-body">
            <div class="modal-title">Are you sure?</div>
            <div>If you proceed, you will lose all your personal data.</div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-link link-secondary me-auto bnt-cancel" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-danger btn-ok"  data-bs-dismiss="modal">Yes</button>
          </div>
        </div>
      </div>
    </div>
    
    
    	<script type="text/javascript">
    		//https://stackoverflow.com/questions/8982295/confirm-deletion-in-modal-dialog-using-twitter-bootstrap

    		var token = $('#_csrf').attr('content');
			var header = $('#_csrf_header').attr('content');
			
    		function doRemove(){
    			
        		var data = 0;
    			$('#confirm-delete').on('show.bs.modal', function(e) {
    			    $(this).find('.btn-ok').attr('id', $(e.relatedTarget).data('id'));
    				
    			});
    			$('#confirm-delete').on('click', '.btn-ok', function(e) {
   				  var $modalDiv = $(e.delegateTarget);
   				  var userId = $modalDiv.find('.btn-ok').attr("id");
   				  
   				  var obj = {userId:userId};
   				  obj = JSON.stringify(obj);
   				  $.ajax({
   					type:'POST',
   					contentType: "application/json; charset=utf-8",
   					url:"/rest/userdelete",
   					data:obj,
   					dataType:'json',
   					beforeSend: function(xhr) {
   		                            xhr.setRequestHeader(header, token);
   		            },
   		            success: function(data){
   		            	if(data.errors == 0){
   		            			$("#tr"+userId).fadeOut('slow').delay(1000);
   		            		   function show_delete(){
   		            			  var successMessage = data.message;
   			      	 			$('#showalert').find('#successfulMessage').html(successMessage);
   								$('#showalert').fadeIn().delay(2000).fadeOut('slow');
   		   		   		
   		            		   };
   		            		   window.setTimeout( show_delete, 100 ); // 5 seconds

   		            		   
   		            		   
   		   					}else{

   		       	  var successMessage = data.message;
	      	 			$('#showalert').find('#successfulMessage').html(successMessage);
						$('#showalert').fadeIn().delay(2000).fadeOut('slow');
   		   					}
   		            },
   		         	error: function(e){
   						alert(JSON.stringify(e));
   		         	}
    			    
   				    });
    		 
    			
    			
    			
    		});
    			
    		};
    			
    		
    		function do_init_select(){
			$("#selectallcheckbox").on("click",function(e){
    			if($("#selectallcheckbox").is(":checked")){
					$(".checkme").prop("checked",true);
					
    			
    			}else{
    				$(".checkme").prop("checked",false);
					
				}
			});

    		
    		}
    			
    			
    			
    		hooks.push(function(){
    			do_init_select();
    			doRemove();
    		});
    	</script>
    
    
        <div th:insert="fragments/layoutdashboard :: footer"></div>
        
      </div>
    </div>
     <div th:insert="fragments/modal :: modal02"></div>
     


   
   
  </body>
</html>